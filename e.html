<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tourism Management System - ER Diagram</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        #diagram {
            width: 100%;
            height: 800px;
            border: 2px solid #ddd;
            border-radius: 10px;
            background: #fafafa;
            overflow: hidden;
        }
        .entity {
            fill: #4a90e2;
            stroke: #2c5aa0;
            stroke-width: 2;
            filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.1));
        }
        .entity:hover {
            fill: #357abd;
            transform: scale(1.05);
            transition: all 0.3s ease;
        }
        .attribute {
            fill: #50e3c2;
            stroke: #2ecc71;
            stroke-width: 1.5;
        }
        .attribute:hover {
            fill: #3dcd9e;
        }
        .relationship {
            fill: #f5a623;
            stroke: #e67e22;
            stroke-width: 2;
        }
        .relationship:hover {
            fill: #d68910;
        }
        .entity-text, .relationship-text {
            fill: white;
            font-weight: bold;
            font-size: 12px;
            text-anchor: middle;
            dominant-baseline: central;
            pointer-events: none;
        }
        .attribute-text {
            fill: #2c3e50;
            font-size: 10px;
            text-anchor: middle;
            dominant-baseline: central;
            pointer-events: none;
        }
        .connection {
            stroke: #34495e;
            stroke-width: 2;
            marker-end: url(#arrowhead);
        }
        .pk {
            text-decoration: underline;
            font-weight: bold;
        }
        .fk {
            font-style: italic;
            fill: #e74c3c;
        }
        .legend {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: rgba(255,255,255,0.8);
            border-radius: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .legend-shape {
            width: 20px;
            height: 15px;
            border-radius: 3px;
        }
        .entity-legend { background-color: #4a90e2; }
        .attribute-legend { background-color: #50e3c2; }
        .relationship-legend { background-color: #f5a623; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Tourism Management System - ER Diagram</h1>
        <svg id="diagram"></svg>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-shape entity-legend"></div>
                <span>Entity</span>
            </div>
            <div class="legend-item">
                <div class="legend-shape attribute-legend"></div>
                <span>Attribute</span>
            </div>
            <div class="legend-item">
                <div class="legend-shape relationship-legend"></div>
                <span>Relationship</span>
            </div>
        </div>
    </div>

    <script>
        const svg = d3.select("#diagram");
        const width = 1300;
        const height = 800;
        
        svg.attr("width", width).attr("height", height);
        
        // Define arrow marker
        svg.append("defs").append("marker")
            .attr("id", "arrowhead")
            .attr("viewBox", "-10 -5 10 10")
            .attr("refX", -5)
            .attr("refY", 0)
            .attr("markerWidth", 6)
            .attr("markerHeight", 6)
            .attr("orient", "auto")
            .append("path")
            .attr("d", "M-10,-5L0,0L-10,5")
            .attr("fill", "#34495e");
        
        // Entity positions
        const entities = {
            "USER": {x: 200, y: 200, width: 100, height: 60},
            "ADMIN": {x: 200, y: 400, width: 100, height: 60},
            "TOURPACKAGES": {x: 800, y: 300, width: 130, height: 60},
            "TBLBOOKING": {x: 500, y: 150, width: 120, height: 60},
            "TBLENQUIRY": {x: 500, y: 350, width: 120, height: 60},
            "TBLISSUES": {x: 500, y: 550, width: 120, height: 60}
        };
        
        // Attributes for each entity
        const attributes = {
            "USER": ["UserId (PK)", "Name", "Email", "Phone", "Password"],
            "ADMIN": ["AdminId (PK)", "Username", "Password", "Mobile", "Email", "UpdationDate"],
            "TOURPACKAGES": ["PackageId (PK)", "PackageName", "PackageType", "Location", "Details", "CreationDate"],
            "TBLBOOKING": ["BookingId (PK)", "PackageId (FK)", "UserId (FK)", "Features", "PersonCount", "TotalAmount"],
            "TBLENQUIRY": ["EnquiryId (PK)", "PackageId (FK)", "UserId (FK)", "FromDate", "MobileNumber", "Status"],
            "TBLISSUES": ["IssueId (PK)", "UserId (FK)", "Subject", "Description", "PostingDate", "AdminRemarkDate"]
        };
        
        // Relationships
        const relationships = [
            {name: "places", from: "USER", to: "TBLBOOKING", x: 350, y: 175},
            {name: "submits", from: "USER", to: "TBLENQUIRY", x: 350, y: 275},
            {name: "reports", from: "USER", to: "TBLISSUES", x: 350, y: 375},
            {name: "manages", from: "ADMIN", to: "TOURPACKAGES", x: 500, y: 450},
            {name: "booked_for", from: "TOURPACKAGES", to: "TBLBOOKING", x: 650, y: 225},
            {name: "enquired_for", from: "TOURPACKAGES", to: "TBLENQUIRY", x: 650, y: 325}
        ];
        
        // Draw connections first
        relationships.forEach(rel => {
            const fromEntity = entities[rel.from];
            const toEntity = entities[rel.to];
            
            // From entity to relationship
            svg.append("line")
                .attr("class", "connection")
                .attr("x1", fromEntity.x + fromEntity.width/2)
                .attr("y1", fromEntity.y + fromEntity.height/2)
                .attr("x2", rel.x)
                .attr("y2", rel.y);
                
            // From relationship to entity
            svg.append("line")
                .attr("class", "connection")
                .attr("x1", rel.x)
                .attr("y1", rel.y)
                .attr("x2", toEntity.x + toEntity.width/2)
                .attr("y2", toEntity.y + toEntity.height/2);
        });
        
        // Draw entities
        Object.entries(entities).forEach(([name, pos]) => {
            const g = svg.append("g");
            
            g.append("rect")
                .attr("class", "entity")
                .attr("x", pos.x)
                .attr("y", pos.y)
                .attr("width", pos.width)
                .attr("height", pos.height)
                .attr("rx", 5);
                
            g.append("text")
                .attr("class", "entity-text")
                .attr("x", pos.x + pos.width/2)
                .attr("y", pos.y + pos.height/2)
                .text(name);
        });
        
        // Draw relationships
        relationships.forEach(rel => {
            const g = svg.append("g");
            
            g.append("polygon")
                .attr("class", "relationship")
                .attr("points", `${rel.x-40},${rel.y} ${rel.x},${rel.y-20} ${rel.x+40},${rel.y} ${rel.x},${rel.y+20}`);
                
            g.append("text")
                .attr("class", "relationship-text")
                .attr("x", rel.x)
                .attr("y", rel.y)
                .attr("font-size", "10px")
                .text(rel.name);
        });
        
        // Draw attributes
        Object.entries(attributes).forEach(([entityName, attrs]) => {
            const entity = entities[entityName];
            attrs.forEach((attr, i) => {
                const angle = (i * 60 - 120) * Math.PI / 180;
                const radius = 120;
                const attrX = entity.x + entity.width/2 + Math.cos(angle) * radius;
                const attrY = entity.y + entity.height/2 + Math.sin(angle) * radius;
                
                const g = svg.append("g");
                
                // Connection line
                svg.append("line")
                    .attr("class", "connection")
                    .attr("x1", entity.x + entity.width/2)
                    .attr("y1", entity.y + entity.height/2)
                    .attr("x2", attrX)
                    .attr("y2", attrY)
                    .attr("stroke-width", 1);
                
                // Attribute oval
                g.append("ellipse")
                    .attr("class", "attribute")
                    .attr("cx", attrX)
                    .attr("cy", attrY)
                    .attr("rx", 45)
                    .attr("ry", 15);
                    
                // Attribute text
                g.append("text")
                    .attr("class", "attribute-text " 
                        + (attr.includes('PK') ? 'pk ' : '') 
                        + (attr.includes('FK') ? 'fk' : ''))
                    .attr("x", attrX)
                    .attr("y", attrY)
                    .text(attr);
            });
        });
    </script>
</body>
</html>
